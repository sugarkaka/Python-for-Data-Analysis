# import pandas and load name 1880
import pandas as pd
import numpy as np
names1880 = pd.read_csv('yob1880.txt', names = ['name', 'sex', 'births'])
names1880

# use the sum of the births column by sex as the total number of births in 1880
names1880.groupby('sex').births.sum()

# use pandas.concat to assenble all of the data into a single dataframe
years = range(1880, 2011)
pieces = []
columns = ['name', 'sex', 'births']
for year in years:
   path = 'yob%d.txt' % year
   frame = pd.read_csv(path, names = columns)
   
   fram['year'] = year
   pieces.append(frame)
names = pd.concat(pieces. ignore_index = True)
names

# start aggregating the data at the year and sex level using groupby and pivot_table
total_births = names.pivot_table('birth', index = 'year', columns = 'sex', aggfunc= sum)
total_births.tail()
total_births.plot(title = 'Total births by sex and year')

# insert column prop with the fraction of babies
def add_prop(group):
    # Integer division floors
    births = group.births.astype(float)
    group['prop'] = births / births.sum()
    return group
names = names.groupby(['year', 'sex']).apply(add_prop)

# use np.allclose to check that 
np.allclose(names.groupby('year', 'sex']).prop.sum(), 1)
    
# analysis the top 1000 names for each sex and year combintination
def top1000(group):
    return group.sort_index(by = 'births', ascending = False)[:1000]
    grouped = names.groupby(['year', 'sex'])
    top1000 = grouped.apply(get_top1000)

pieces = []
for year, group in names.groupby(['year', 'sex']):
    pieces.append(group.sort_index(by = 'births', assending = False)[:1000])
top1000 = pd.concat(pieces, ignore_index = True)

# Spilt the top 1000 names into the boy and the girl portions
boys = top1000[top1000.sex == 'M']
girls = top1000[top1000.sex == 'F']

# Form a pivot table of the total number of births by year and sex 
total_births = top1000.pivot_table('births', index = 'year', columns = 'sex', aggfunc = sum)
total_births

# Plot for the handful of names 
subset = total_births[['John', 'Harry', 'Mary', 'Marilyn']]
subset.plot(subplots = True, figsize = (12, 10). grid = False, title = 'Number of births per year')

# The proportion of births represented by the top 1000 most popular names 
table = top1000.pivot_table('prop', index = 'year', columns = 'sex', aggfunc = sum)
table.plot(title = 'Sum of the table1000/prop by year and sex', yticks = np.linspace(0,1.2, 13), xticks = range(1880, 2020, 10))

df = boys[ boys.year == 2010]
df

